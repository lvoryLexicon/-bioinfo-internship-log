这是从参考基因组准备到序列比对数据处理再到可视化的全过程的教程，按照标准二代测序（NGS）流程逻辑，教程会说明每一步的作用与成果。

---

 ✅ 1. 目标理解与工作方向明确

明确本项目的核心目标：

> 利用病人样本中的 DNA 测序数据，通过比对人类参考基因组，检测是否存在病毒序列插入（例如 TTMV），并定位其位置。

---

 ✅ 2. 参考基因组下载与定位

找到可用的人类基因组文件：
 例如：
 文件名：GRCh38.primary_assembly.genome.fa
 位置：/public/DATA/common_data/genome/hg38/

📌 作用：这是一份国际标准的人类基因组序列，作为比对的“参照”。

---

 ✅ 3. 复制参考基因组到个人工作目录

将 GRCh38.primary_assembly.genome.fa 复制到你自己的工作目录中：

bash
cp /public/DATA/common_data/genome/hg38/GRCh38.primary_assembly.genome.fa ~/genome/


📂 你的工作目录路径为：/public/home/shenyz/genome/

---

 ✅ 4. 为人类基因组构建 BWA 索引

使用 bwa index 为参考基因组构建索引：

bash
bwa index GRCh38.primary_assembly.genome.fa


🔧 输出文件包括：

 .amb, .ann, .bwt, .pac, .sa

📌 作用：BWA 索引能让后续比对迅速定位参考序列，提高效率。

---

 ✅ 5. 原始测序数据（样本 FASTQ）准备

已经准备好的成对的 clean FASTQ 文件：

bash
zzq_1.clean.fq
zzq_2.clean.fq


✅ 这通常来自于下游质控工具的输出，如：Trimmomatic、fastp

---

 ✅ 6. 掌握 Seqkit 并完成质控统计

安装 seqkit 并使用以下命令进行基本质量统计：

bash
seqkit stats -j 12 zzq_1.clean.fq zzq_2.clean.fq


📊 得到的信息包括：

 总序列数
 总碱基数
 N50、GC 含量、最大/最小序列长度等

📌 作用：确认数据规模与质量，为比对和后续分析提供判断依据。

---

 ✅ 7. 掌握了多线程比对命令的写法

学会如何使用 bwa mem 多线程比对：

bash
bwa mem -t 12 GRCh38.primary_assembly.genome.fa zzq_1.clean.fq zzq_2.clean.fq > zzq.sam 2> bwa_mem.log


📌 作用：将样本 DNA 序列与参考基因组比对，输出 .sam 格式文件以供下游处理。

---

 ✅ 8. 发现流程问题并及时修正思路

例如更优解：

> 应该将病毒基因组（如 TTMV）和人类参考基因组合并，再构建索引并比对。这样才能让 BWA 识别病毒插入序列。

已经具备如下条件：

 TTMV.fa 病毒序列已在工作目录中
 合并 fasta 的做法：

bash
cat GRCh38.primary_assembly.genome.fa TTMV.fa > human_virus.fa


 已准备重新索引并比对

---

 🧩 到目前为止的关键成果汇总

| 模块      | 完成情况 | 说明                          |
| ------- | ---- | --------------------------- |
| 项目目标理解  | ✅    | 明确目标是检测病毒插入片段               |
| 环境准备    | ✅    | 安装了 BWA、Seqkit，掌握了 Linux 操作 |
| 基因组文件准备 | ✅    | 下载并索引了 GRCh38               |
| 测序数据准备  | ✅    | clean FASTQ 文件就绪            |
| 数据统计与质控 | ✅    | 使用 seqkit 获取质量指标            |
| 比对流程掌握  | ✅    | 熟悉 bwa mem 和后台运行（nohup）   |
| 方法更新    | ✅    | 明白需要合并人类+病毒序列参考基因组          |

---

 ✅ 下一步推荐操作（按顺序）

1. 合并参考基因组并索引

bash
cd ~/genome
cat GRCh38.primary_assembly.genome.fa ~/TTMV.fa > human_virus.fa
bwa index human_virus.fa


2. 重新运行比对任务

bash
nohup bwa mem -t 12 human_virus.fa ~/zzq_1.clean.fq ~/zzq_2.clean.fq > zzq_hv.sam 2> bwa_hv.log &


3. 后处理：转换为 BAM、排序、建索引

bash
samtools view -Sb zzq_hv.sam > zzq_hv.bam
samtools sort zzq_hv.bam -o zzq_hv.sorted.bam
samtools index zzq_hv.sorted.bam


4. 可视化比对结果：在 IGV 中加载 human_virus.fa 和 zzq_hv.sorted.bam
